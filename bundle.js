(()=>{"use strict";class t{constructor(t){const e=document.getElementById(t);if(null===e||!(e instanceof HTMLCanvasElement))throw new Error(`Could not find target element ${t}!`);this.canvas=e,this.canvas.width=640,this.canvas.height=400;const n=this.canvas.getContext("2d");if(null===n)throw new Error("Could not establish canvas 2d context!");this.ctx=n,this.ctx.imageSmoothingEnabled=!1,this.ctx.fillStyle="green",this.ctx.fillRect(0,0,640,400),this.bg_canvas=document.createElement("canvas"),this.bg_canvas.width=640,this.bg_canvas.height=400;const i=this.bg_canvas.getContext("2d");if(null===i)throw new Error("Could not establish background canvas 2d context!");this.bg_ctx=i,this.bg_ctx.imageSmoothingEnabled=!1}render(t,e){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.bg_ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.bg_ctx.putImageData(t,0,0),this.ctx.drawImage(this.bg_canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.canvas.width*e,this.canvas.height*e)}}var e,n,i,s,o,a,h;const d=new class{constructor(){this.bits=8,this.zoom=1,this.width=64,this.offset=0,this.screen=new t("visoutput"),this.content_buffer=new ArrayBuffer(4),this.content=new Uint8ClampedArray(this.content_buffer),this.image_data=new ImageData(this.content,1);const e=document.getElementById("output_coord");if(null===e||!(e instanceof HTMLOutputElement))throw new Error("No output element found!");this.output=e}update_screen(){this.screen.render(this.image_data,this.zoom)}update_content(){const t=new Uint8Array(this.content_buffer.slice(this.offset)),e=Math.ceil(t.length/this.width)*this.width*4;this.content=new Uint8ClampedArray(e);for(let e=0;e<t.length;e++)this.content[4*e]=t[e],this.content[4*e+1]=t[e],this.content[4*e+2]=t[e],this.content[4*e+3]=255;this.image_data=new ImageData(this.content,this.width),this.update_screen()}update_width(t){this.width=t,this.update_content()}update_zoom(t){this.zoom=t,this.update_screen()}update_offset(t){this.offset=t,this.update_content()}load(t){this.content_buffer=t,this.update_content()}update_mouse_coordinate(t){const[e,n]=function(t,e){const n=t.getBoundingClientRect();return[e.clientX-n.left,e.clientY-n.top]}(this.screen.canvas,t);if(e<0||n<0||n>400||e>this.width*this.zoom)return void(this.output.value="");const i=this.offset+Math.floor(e/this.zoom)+Math.floor(n/this.zoom)*this.width;this.output.value=`${i} 0x${i.toString(16).toUpperCase()}`}},c="test.bmp";fetch(new Request(c)).then((t=>{if(!t.ok)throw new Error(`HTTP error loading ${c}: ${t.status}`);return t.arrayBuffer()})).then((t=>{d.width=Number(document.getElementById("input_width").value),d.zoom=Number(document.getElementById("input_zoom").value),d.offset=Number(document.getElementById("input_offset").value),d.load(t)})),null===(e=document.getElementById("input_file"))||void 0===e||e.addEventListener("change",(t=>{const e=t.target.files;if(!e||1!==e.length)throw new Error("No file was given for upload.");e[0].arrayBuffer().then((t=>{d.load(t)}))})),null===(n=document.getElementById("button_update"))||void 0===n||n.addEventListener("click",d.update_screen),null===(i=document.getElementById("visoutput"))||void 0===i||i.addEventListener("mousemove",(t=>{d.update_mouse_coordinate(t)})),null===(s=document.getElementById("visoutput"))||void 0===s||s.addEventListener("mouseout",(t=>{d.update_mouse_coordinate(t)})),null===(o=document.getElementById("input_width"))||void 0===o||o.addEventListener("change",(t=>{d.update_width(Number(t.target.value))})),null===(a=document.getElementById("input_zoom"))||void 0===a||a.addEventListener("change",(t=>{d.update_zoom(Number(t.target.value))})),null===(h=document.getElementById("input_offset"))||void 0===h||h.addEventListener("change",(t=>{d.update_offset(Number(t.target.value))}))})();